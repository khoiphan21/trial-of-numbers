<div class="game-container" *ngIf="game">
  <header class="game-header">
    <div class="header-left">
      <button class="home-button" routerLink="/">
        <span class="material-icons">home</span>
        Home
      </button>
    </div>
    <div class="header-center">
      <h1>Trial of Numbers</h1>
    </div>
    <div class="header-right">
      <p>Game ID: {{ game.id }}</p>
      <p>Round: {{ game.roundNumber + 1 }}/10</p>
    </div>
  </header>

  <!-- New Game Button -->
  @if (canStartNewGame && currentPlayer?.isHost) {
  <div class="new-game-section">
    <button class="new-game-button" (click)="startNewGame()">
      <span class="material-icons">refresh</span>
      Start New Game
    </button>
    <p class="info-text">
      @if (game.roundNumber >= 10) { Round limit reached. Start a new game? }
      @else { All players have submitted their guesses. Start a new game? }
    </p>
  </div>
  }

  <!-- Scoreboard -->
  @if (game.gameState === 'in_progress') {
  <app-scoreboard
    [game]="game"
    [currentPlayerId]="currentPlayer?.id"
  ></app-scoreboard>
  }

  <!-- Game Controls -->
  <app-game-controls
    *ngIf="currentPlayer"
    [game]="game"
    [currentPlayer]="currentPlayer"
  ></app-game-controls>

  <main class="game-board">
    <!-- Waiting State -->
    <div class="waiting-screen" *ngIf="game.gameState === 'waiting'">
      <h2>Waiting for Players</h2>
      <div class="player-list">
        <h3>Players ({{ game.players.length }}/10):</h3>
        <ul>
          <li *ngFor="let player of game.players">
            {{ player.name }} {{ player.isHost ? '(Host)' : '' }}
          </li>
        </ul>
      </div>
      <p>
        Share this Game ID with your friends to join:
        <strong>{{ game.id }}</strong>
      </p>
      @if (game.players.length < 2) {
      <div class="waiting-message">
        Waiting for at least one more player to join...
      </div>
      }
    </div>

    <!-- Game In Progress -->
    <div class="game-play" *ngIf="game.gameState === 'in_progress'">
      <!-- Hint Board -->
      <div class="hint-board">
        @for (slot of SLOTS; track slot) {
        <div class="slot">
          <h3>Slot {{ slot }}</h3>
          <div class="hints">
            <!-- Correct Hints -->
            <div class="hint-section correct-hints">
              <h4>Correct Hints</h4>
              @if (game.slots?.[slot]?.submittedHints?.length) { @for
              (submission of game.slots[slot].submittedHints; track
              submission.playerId) { @for (hint of submission.hints; track
              hint.hint.id) { @if (isHintValid(slot, hint.hint)) {
              <app-hint-card
                [hint]="hint.hint"
                [correct]="true"
              ></app-hint-card>
              } } } }
            </div>

            <!-- Incorrect Hints -->
            <div class="hint-section incorrect-hints">
              <h4>Incorrect Hints</h4>
              @if (game.slots?.[slot]?.submittedHints?.length) { @for
              (submission of game.slots[slot].submittedHints; track
              submission.playerId) { @for (hint of submission.hints; track
              hint.hint.id) { @if (!isHintValid(slot, hint.hint)) {
              <app-hint-card
                [hint]="hint.hint"
                [incorrect]="true"
              ></app-hint-card>
              } } } }
            </div>
          </div>
        </div>
        }
      </div>

      <!-- Player Hand -->
      @if (currentPlayer) {
      <app-player-hand
        [game]="game"
        [currentPlayer]="currentPlayer"
      ></app-player-hand>
      }
    </div>

    <!-- Game Completed -->
    <div class="game-over" *ngIf="game.gameState === 'completed'">
      <h2>Game Over!</h2>
      <div class="final-scores">
        <h3>Final Scores:</h3>
        <ul>
          <li *ngFor="let player of game.players">
            {{ player.name }}: {{ player.score }} points
          </li>
        </ul>
      </div>
    </div>
  </main>
</div>
